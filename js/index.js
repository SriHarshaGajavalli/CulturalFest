"use strict";var main={init:function(t){var e=this;return this.vars(),this.initContainer(),this.initClose(),this.initHideClose(),this.prepareSprites(),this.events(),this.draw(),setInterval(function(){e.updateProgress(!1)},10),this},initContainer:function(){this.iscroll=new IScroll("#js-wrapper",{scrollX:!0,freeScroll:!0,mouseWheel:!0,probeType:3});var t=-this.centerX+this.wWidth/2+this.xOffset,e=-this.centerY+this.wHeight/2+this.yOffset;this.iscroll.scrollTo(t,e,10)},vars:function(){this.S=1,this.loadCnt=0,this.maxLoadCnt=8,this.BLOB_DURATION=500,this.ext=this.isCanPlayMP3()?"mp3":"wav",this.isIE=this.isIE(),this.isIOS=!!/(iPad|iPhone|iPod)/g.test(navigator.userAgent),this.isIOS&&document.body.classList.add("ios"),!this.isTabletMobile&&document.body.classList.add("desktop"),this.progressStep=150/this.maxLoadCnt*(1/16),this.getDOMElements(),this.particleRadius=parseInt(getComputedStyle(this.particles[0]).width,10)/2,this.particlesLength=this.particles.length,this.radPoint=mojs.helpers.getRadialPoint,this.particleBuffer=null,this.isOpen=!1,this.blobBase=1.6,this.blob=this.blobBase,this.blobShift=this.blobBase,this.xOffset=this.particleRadius+25,this.yOffset=1.4*this.particleRadius;var t=getComputedStyle(this.particlesContainer);this.width=parseInt(t.width,10),this.height=parseInt(t.height,10),this.prepareDust(),this.calcDimentions(),this.loadAssets();for(var e=this.particlesLength;e--;){var s=this.particles[e];s.x=parseInt(s.getAttribute("data-left"),10),s.y=parseInt(s.getAttribute("data-top"),10)}},getDOMElements:function(){this.particlesContainer=document.querySelector("#scroller"),this.particles=document.querySelectorAll(".particle"),this.closeBtn=document.querySelector("#js-close-btn"),this.blobCircle=document.querySelector("#js-blob-circle"),this.blobEllipses=this.blobCircle.querySelectorAll("#js-blob-circle-ellipse"),this.dust1=document.querySelector("#js-dust-1"),this.dust2=document.querySelector("#js-dust-2"),this.dust3=document.querySelector("#js-dust-3"),this.dust4=document.querySelector("#js-dust-4"),this.content=document.querySelector("#js-content"),this.curtain=document.querySelector("#js-curtain"),this.progress=document.querySelector("#js-progress"),this.progressGrad=document.querySelector("#js-progress-gradient")},draw:function(){var t=this.bubleCenter.x+"px "+this.bubleCenter.y+"px",e=mojs.h,s=mojs.easing.cubic["in"],i=this.particlesLength;for(e.setPrefixedStyle(this.particlesContainer,"perspective-origin",t);i--;){this.particleBuffer=this.particles[i];var n=Math.abs(this.bubleCenter.x-this.particleBuffer.x),o=Math.abs(this.bubleCenter.y-this.particleBuffer.y),r=Math.sqrt(n*n+o*o),a=this.blob-2*r/this.size,l=this.blobShift-2*r/this.size,h=1,c=mojs.helpers.clamp(s(a),.03,h),u=e.clamp(s(l),.03,h),d=this.particleBuffer.prevDelta!==c;if(d||this.particleBuffer.prevDeltaShift!==u){var p=-150*s(1-u),m="scale("+c+") translateZ("+p+"px)";e.setPrefixedStyle(this.particleBuffer,"transform",m),this.particleBuffer.prevDelta=c,this.particleBuffer.prevDeltaShift=u}}requestAnimationFrame(this.draw.bind(this))},calcDimentions:function(){this.wWidth=window.innerWidth,this.wHeight=window.innerHeight,this.centerY=this.height/2-this.wHeight/2,this.centerX=this.width/2-this.wWidth/2,this.bubleCenter={x:this.centerX,y:this.centerY};var t=Math.sqrt(this.wHeight*this.wHeight),e=Math.sqrt(this.wWidth*this.wWidth);this.size=1*Math.min(t,e)},start:function(){this.curtain.classList.add("is-hide"),this.startBlob()},startBlob:function(){var t=this,e=new mojs.Tween,s=new mojs.Timeline({duration:1200*this.S,onUpdate:function(e){t.blob=t.blobBase+.3*(1-mojs.easing.elastic.out(e))}}),i=(this.bubleCenter.x,this.bubleCenter.y,new mojs.Timeline({duration:1200*this.S,delay:0*this.S,onUpdate:function(e){t.blobShift=t.blobBase+.5*(1-mojs.easing.elastic.out(e))},onStart:function(){t.closeScaleSound.play()}}));e.add(s,i),e.start()},updateProgress:function(){var t=arguments.length<=0||void 0===arguments[0]?!0:arguments[0];if(!t){var e=(this.maxLoadCnt-++this.loadCnt)*this.progressStep;this.progress.style.width=e+"rem",mojs.h.setPrefixedStyle(this.progressGrad,"transform","translateX(-"+this.loadCnt*this.progressStep/1.3+"rem)"),this.loadCnt===this.maxLoadCnt&&this.start()}},loadAssets:function(){this.openSound=new Howl({urls:["https://s3-us-west-2.amazonaws.com/s.cdpn.io/6859/open-bubble-2."+this.ext],onload:this.updateProgress.bind(this)}),this.openSound2=new Howl({urls:["https://s3-us-west-2.amazonaws.com/s.cdpn.io/6859/open-bubble-3."+this.ext],rate:.15,onload:this.updateProgress.bind(this)}),this.bounceSound=new Howl({urls:["https://s3-us-west-2.amazonaws.com/s.cdpn.io/6859/bounce."+this.ext]}),this.closeSound=new Howl({urls:["https://s3-us-west-2.amazonaws.com/s.cdpn.io/6859/bubble-single-1."+this.ext],rate:.5,onload:this.updateProgress.bind(this)}),this.closeSound2=new Howl({urls:["https://s3-us-west-2.amazonaws.com/s.cdpn.io/6859/bubble-single-1."+this.ext],rate:.75,onload:this.updateProgress.bind(this)}),this.closeSound3=new Howl({urls:["https://s3-us-west-2.amazonaws.com/s.cdpn.io/6859/bubble-single-1."+this.ext],rate:.85,onload:this.updateProgress.bind(this)}),this.closeScaleSound=new Howl({urls:["https://s3-us-west-2.amazonaws.com/s.cdpn.io/6859/open-bubble-3."+this.ext],rate:.25,onload:this.updateProgress.bind(this)}),this.closeBtnSound=new Howl({urls:["https://s3-us-west-2.amazonaws.com/s.cdpn.io/6859/open-bubble-3."+this.ext],rate:1,onload:this.updateProgress.bind(this)}),this.loadImage("https://s3-us-west-2.amazonaws.com/s.cdpn.io/6859/mojs-logo.png")},loadImage:function(t){var e=new Image;e.addEventListener("load",this.updateProgress.bind(this),!1),e.addEventListener("error",this.updateProgress.bind(this),!1),e.src=t},isCanPlayMP3:function(){var t=navigator.userAgent;return!(t.indexOf("Opera")&&t.indexOf("firefox")>-1)},isIE:function(){return!(!window.navigator.msPointerEnabled||window.PointerEvent)},isTabletMobile:function(){return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)}(),setBubblePosition:function(){this.bubleCenter.x=-this.iscroll.x+this.wWidth/2+this.xOffset,this.bubleCenter.y=-this.iscroll.y+this.wHeight/2+this.yOffset},events:function(){var t=this;window.addEventListener("resize",function(){t.calcDimentions(),t.setBubblePosition()}),new Hammer(document.body).on("tap",function(e){var s=e.target.parentNode;return t.isOpen?e.preventDefault():void(s.classList.contains("particle")?t.showOnEl(s):s.parentNode.classList.contains("particle")&&t.showOnEl(s.parentNode))}),new Hammer(this.closeBtn).on("tap",this.closeEl.bind(this)),document.addEventListener("touchmove",function(t){t.preventDefault()},!1),this.iscroll.on("scroll",this.setBubblePosition.bind(this))},initClose:function(){var t=this,e=400*this.S,s={parent:document.querySelector("#js-close-btn"),type:"circle",radius:{0:15},fill:"transparent",stroke:"white",strokeWidth:{5:0},x:"50%",y:"50%",duration:e,isRunLess:!0};this.closeCircle=new mojs.Transit(s);var i={type:"cross",delay:.4*e,angle:45,strokeWidth:2,radius:{0:8},isShowEnd:!0,onStart:function(){t.closeSound.play()}};mojs.h.extend(i,s),this.closeCross=new mojs.Transit(i);var n={type:"line",radius:{0:30},strokeWidth:{4:0},delay:.4*e,childOptions:{radius:{5:0}}};mojs.h.extend(n,s),this.closeBurst=new mojs.Burst(n);var o={parent:document.querySelector("#js-close-btn"),type:"circle",radius:{0:10},fill:"transparent",stroke:"white",strokeWidth:{5:0},x:"-20%",y:"-50%",isRunLess:!0,delay:.7*e,duration:400*this.S,onStart:function(){t.closeSound2.play()}};this.closeCircle2=new mojs.Transit(o);var r={x:"80%",y:"-30%",radius:{0:6},delay:1.1*e,duration:300*this.S,onStart:function(){t.closeSound3.play()}};mojs.h.extend(r,o),this.closeCircle3=new mojs.Transit(r);var a={x:"50%",y:"130%",radius:{0:4},delay:.9*e,duration:200*this.S,onStart:function(){t.closeSound3.play()}};mojs.h.extend(a,o),this.closeCircle4=new mojs.Transit(a),this.showCloseBtnTween=new mojs.Tween,this.showCloseBtnTween.add(this.closeCircle.tween,this.closeCircle2.tween,this.closeCircle3.tween,this.closeCircle4.tween,this.closeCross.tween,this.closeBurst.tween)},showClose:function(){this.closeBtn.classList.add("is-show"),this.showCloseBtnTween.start()},initHideClose:function(){var t=this;this.hideBurst=new mojs.Burst({x:"50%",y:"50%",parent:this.closeBtn,radius:{0:100},type:"circle",fill:"white",degree:25,isSwirl:!0,randomRadius:1,isRunLess:!0,childOptions:{radius:{"rand(12,5)":0}},duration:500*this.S,onUpdate:function(e){e=mojs.easing.cubic["in"](e),mojs.h.setPrefixedStyle(t.closeCross.el,"transform","scale("+(1-e)+")")},onStart:function(){t.closeBtnSound.play()},onComplete:function(){t.closeBtn.classList.remove("is-show"),mojs.h.setPrefixedStyle(t.closeCross.el,"transform","none")}}),this.hideCircle=new mojs.Transit({x:"50%",y:"50%",parent:this.closeBtn,type:"circle",radius:{0:15},fill:"transparent",stroke:"white",strokeWidth:{8:0},isRunLess:!0,duration:500*this.S})},hideClose:function(){this.hideBurst.run(),this.hideCircle.run()},closeEl:function(){var t=this;this.iscroll.enabled=!0,this.isOpen=!1,this.hideClose();var e=this.currentEl.querySelector(".particle__inner"),s=new mojs.Tween,i=new mojs.Timeline({duration:500*this.S,onUpdate:function(s){var i=1-s,n=mojs.easing.cubic.inout(i),o=.75+18*n,r="scale("+o+") translateZ(0)";mojs.h.setPrefixedStyle(e,"transform",r),mojs.h.setPrefixedStyle(t.content,"transform","scale("+n+") translateZ(0)")}}),n=new mojs.Timeline({delay:0*this.S,onStart:function(){t.closeScaleSound.play()}}),o=new mojs.Timeline({duration:1e3*this.S,onUpdate:function(t){var s=.75+.25*mojs.easing.elastic.out(t),i="scale("+s+") translateZ(0)";mojs.h.setPrefixedStyle(e,"transform",i)},onComplete:function(){return t.isOpen?mojs.h.setPrefixedStyle(t.content,"transform","translate3d(-5000px,-5000px,0)"):void mojs.h.setPrefixedStyle(t.content,"transform","translate3d(-5000px,-5000px,0)")}});s.add(i),s.append(o);var r=new mojs.Tween,a=new mojs.Timeline({duration:1200*this.S,delay:300*this.S,onUpdate:function(e){t.isOpen||(t.blobShift=t.blobBase+(1-mojs.easing.elastic.out(e)))}}),l=new mojs.Timeline({duration:2100*this.S,delay:0*this.S,onUpdate:function(e){t.isOpen||(t.blob=t.blobBase+.3*(1-mojs.easing.elastic.out(e)))}});r.add(a,l,n),this.jellyTween=new mojs.Tween,this.jellyTween.add(s,r),this.jellyTween.start()},moveTextEl:function(t,e){e=mojs.easing.cubic.out(e);var s="rotate("+90*(1-e)+"deg) translateZ(0) translateY("+200*(1-e)+"%)",i="left "+80*e+"%";mojs.h.setPrefixedStyle(t,"transform",s),mojs.h.setPrefixedStyle(t,"transform-origin",i),t.style.opacity=mojs.easing.cubic.out(e)},prepareDust:function(){this.dust1Spriter=new mojs.Spriter({el:this.dust1,duration:300*this.S,delay:275*this.S,isRunLess:!0}),this.dust2Spriter=new mojs.Spriter({el:this.dust2,duration:200*this.S,delay:575*this.S,isRunLess:!0}),this.dust3Spriter=new mojs.Spriter({el:this.dust3,duration:100*this.S,delay:725*this.S,isRunLess:!0})},runDust:function(){this.isTabletMobile||this.isIE||(this.dust1Spriter.run(),this.dust2Spriter.run(),this.dust3Spriter.run())},showInnerPlastic:function(t){var e=this,s=new mojs.Tween,i=t.querySelector(".image"),n=t.querySelector(".shape"),o=t.querySelector("#js-shadow"),r=t.querySelector("#js-shadow-wrap");this.runDust();var a=(new mojs.MotionPath({path:{x:-300,y:-300},curvature:{x:"75%",y:"50%"},offsetX:300,offsetY:300,el:i,duration:this.isIE?200*this.S:1e3*this.S,easing:"cubic.out",onPosit:function(t,e,s,i){t=mojs.easing.expo.out(mojs.easing.cubic["in"](t));var n="rotateX(70deg) rotateZ("+-60*(1-t)+"deg)",r="translateX("+e+"px) translateY("+s+"px)",a="scaleY("+(2.5-1.5*t)+")";return mojs.h.setPrefixedStyle(o,"transform",r+" "+n+" "+a),"translate3d("+e+"px, "+s+"px, 0)"}}),mojs.easing.path("M0,0 C0,0 32.1191406,0.314142863 40.1669859,0 C40.1669859,0.165327852 50.9999996,-112.569017 74.0660521,0 C80.8905119,-16.0420643 87.1001393,-19.621745 92.0689049,0 C92.0689049,1.54522552 95.3231688,-14.8615687 100,0")),l=mojs.easing.path("M0,100 C28.3125,98.6523445 39.0445328,8.99375039 40.1669859,0 C40.1669859,-0.0485295402 50.9999996,152.873952 74.0660521,0 C80.8905119,21.9365596 87.1001393,26.7923438 92.0689049,0 C92.0689049,-1.92034044 95.3231688,20.3352347 100,0"),h=new mojs.Timeline({duration:this.isIE?200*this.S:800*this.S,onStart:function(){mojs.h.setPrefixedStyle(e.content,"transform","translate3d(0,0,0)")},onComplete:function(){e.showClose()},onUpdate:function(t){var e=mojs.easing.bounce.out(t),s=(mojs.easing.bounce["in"](t),mojs.easing.cubic.out(t)),i="rotateY("+90*(1-e)+"deg) rotateX("+70*(1-s)+"deg) rotateZ("+90*(1-s)+"deg)",h="scaleX("+a(t)+")",c="translate("+(-300*mojs.easing.bounce["in"](1-t)-5)+"px, 2px) "+h;mojs.h.setPrefixedStyle(n,"transform",""+i),mojs.h.setPrefixedStyle(n,"transform-origin",50+50*s+"% 100%"),mojs.h.setPrefixedStyle(r,"transform",c),n.style.opacity=mojs.easing.expo.out(t),o.style.opacity=.75*l(t)}}),c=new mojs.Timeline({delay:300*this.S,onStart:function(){e.isIE||e.bounceSound.play()}});s.add(h,c),s.start()},prepareSprites:function(){this.blobSprite=new mojs.Spriter({el:this.blobCircle,duration:this.BLOB_DURATION*this.S,isRunLess:!0})},showInnerCircle:function(t,e){var s=this;this.blobCircle.style.left=t+"px",this.blobCircle.style.top=e+"px";for(var i=new mojs.Tween,n=Math.min(this.wWidth,this.wHeight),o=Math.min(10*mojs.easing.cubic["in"](n/800),20),r=30+2*o,a=o/2/this.blobEllipses.length,l=0,l=0;l<this.blobEllipses.length;l++){var h=this.blobEllipses[l];h.setAttribute("stroke-width",o/2-l*a),h.setAttribute("rx",r/2),h.setAttribute("ry",r/2)}this.blobCircle.style.display="block";var c=new mojs.Timeline({duration:this.BLOB_DURATION*this.S,onStart:function(){s.blobSprite.run(),s.openSound.play()},onUpdate:function(t){var e="scale("+28*t+") translateZ(0)";mojs.h.setPrefixedStyle(s.blobCircle,"transform",e),s.blobCircle.style.opacity=1*mojs.easing.cubic["in"](1-t)}});i.add(c),i.start()},showOnEl:function(t){var e=this;if(this.prevEl=this.currentEl,this.currentEl=t,this.prevEl&&(this.prevEl.style["z-index"]=0),!(t.delta<.2)){var s=t.x-this.wWidth/2-this.xOffset,i=t.y-this.wHeight/2-this.yOffset,n=t.querySelector(".particle__inner"),o=(t.querySelector(".particle__content"),new mojs.Tween);this.isOpen=!0,t.style["z-index"]=20,this.iscroll.enabled=!1,this.showInnerCircle(t.x+75,t.y+75),this.iscroll.scrollTo(-s,-i,500*this.S);var r=new mojs.Timeline({delay:0*this.S,onStart:function(){e.openSound2.play()}}),a=new mojs.Timeline({duration:300*this.S,easing:"expo.out",onUpdate:function(t){mojs.h.setPrefixedStyle(n,"transform","scale("+(1-.25*t)+") translateZ(0)"),n.style.opacity=1-.25*t}}),l=new mojs.Timeline({duration:600*this.S,delay:100*this.S,onUpdate:function(t){e.blob=e.blobBase+.3*mojs.easing.cubic.out(t),e.blobShift=e.blobBase+1*t}});mojs.h.setPrefixedStyle(this.content,"transform","translate3d(-5000px,-5000px,0)");var h=new mojs.Timeline({duration:600*this.S,delay:350*this.S,onUpdate:function(t){var e=19*mojs.easing.cubic["in"](t);e=Math.max(.75,e);var s="scale("+e+") translateZ(0)";mojs.h.setPrefixedStyle(n,"transform",s),n.style.opacity=.75+.25*mojs.easing.cubic.out(t)},onStart:function(){setTimeout(function(){e.showInnerPlastic(e.content)},400)},onComplete:function(){e.blobCircle.style.display="none"}});o.add(a,r,l,h),o.start()}}};main.init();
